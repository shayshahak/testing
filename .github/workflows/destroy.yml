# This is a basic workflow to help you get started with Actions

name: Destroy Environment

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on: [workflow_run]


# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Set the target Azure Kubernetes Service (AKS) cluster. 
    - uses: azure/aks-set-context@v1
      with:
        creds: '${{ secrets.AZURE_CREDENTIALS }}'
        cluster-name: ${{ secrets.CLUSTER_NAME }}
        resource-group: ${{ secrets.CLUSTER_RESOURCE_GROUP }}
    # Delete deployment
    - run: |
        kubectl delete deployment php-deployment
    # Delete service
       - run: |
        kubectl delete svc whalephp-svc
